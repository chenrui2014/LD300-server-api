{"version":3,"sources":["../../../src/ipcs/dahua/_dh_nvr.js"],"names":["PTZ","require","DHIPC","_","dhok","dhlib","ref","DHNVR","options","brand","video_protocol","ptz_protocol","audio_protocol","_channel","nvr_channel","callback","cmd","p1","_loginID","process","nextTick","functions","CLIENT_PTZControl","__lastCmd","bind","logError","id","_PTZ","enums","PTZ_ZOOM_ADD","zoom_speed","PTZ_ZOOM_DEC","PTZ_FOCUS_ADD","focus_speed","PTZ_FOCUS_DEC","PTZ_APERTURE_ADD","aperture_speed","PTZ_APERTURE_DEC","direction","isDemo","_d","Directions","top","PTZ_UP","left","PTZ_LEFT","right","PTZ_RIGHT","down","PTZ_DOWN","v_speed","h_speed","pt","cb","PTZ_POINT_MOVE","index","PTZ_POINT_SET","exports","module"],"mappings":"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","file":"_dh_nvr.js","sourcesContent":["/**\r\n * Created by Luky on 2017/7/1.\r\n */\r\nconst PTZ=require('../base/ptz');\r\nconst DHIPC=require('./dh_ipc');\r\nconst _=require('lodash');\r\nconst dhok=require('./dh_init');\r\nconst dhlib=require('./dhnetsdk');\r\nconst ref=require('ref');\r\n\r\n//CLIENT_SearchDevices\r\n//CLIENT_SearchDevicesByIPs\r\n//查询局域网设备\r\n\r\nclass DHNVR extends DHIPC{\r\n    constructor(options){\r\n        super(options);\r\n        this.brand='';\r\n        this.video_protocol='onvif';\r\n        this.ptz_protocol=\"config\";\r\n        this.audio_protocol=\"dahua\";\r\n        this._channel=this.nvr_channel;\r\n    }\r\n\r\n    _PTZ(callback,cmd,p1){\r\n\r\n        if(!this._loginID){\r\n            if(callback)process.nextTick(()=>{\r\n                callback('connect first');\r\n            });\r\n            return;\r\n        }\r\n        callback=callback||function(){};\r\n        process.nextTick(()=>{\r\n            if(dhlib.functions.CLIENT_PTZControl(this._loginID,this.nvr_channel,cmd,p1,0)){\r\n                this.__lastCmd=_.bind(dhlib.functions.CLIENT_PTZControl,null,this._loginID,this.nvr_channel,cmd,p1,1);\r\n                callback();return;\r\n            }\r\n            this.logError(this.id,'ptz',callback);\r\n        });\r\n    }\r\n\r\n    zoomIn(callback) {\r\n        this._PTZ(callback,dhlib.enums.PTZ.PTZ_ZOOM_ADD,this.zoom_speed);\r\n    }\r\n    zoomOut(callback) {\r\n        this._PTZ(callback,dhlib.enums.PTZ.PTZ_ZOOM_DEC,this.zoom_speed);\r\n    }\r\n    focusIn(callback) {\r\n        this._PTZ(callback,dhlib.enums.PTZ.PTZ_FOCUS_ADD,this.focus_speed);\r\n    }\r\n    focusOut(callback) {\r\n        this._PTZ(callback,dhlib.enums.PTZ.PTZ_FOCUS_DEC,this.focus_speed);\r\n    }\r\n    apertureIn(callback) {\r\n        this._PTZ(callback,dhlib.enums.PTZ.PTZ_APERTURE_ADD,this.aperture_speed);\r\n    }\r\n    apertureOut(callback) {\r\n        this._PTZ(callback,dhlib.enums.PTZ.PTZ_APERTURE_DEC,this.aperture_speed);\r\n    }\r\n    move(direction,callback){\r\n        if(!this.isDemo){\r\n            if(callback)process.nextTick(()=> {\r\n                callback('not a demo');\r\n            });\r\n            return;\r\n        }\r\n        let _d=PTZ.Directions;\r\n        switch(direction) {\r\n            case _d.top:\r\n                direction = dhlib.enums.PTZ.PTZ_UP;\r\n                break;\r\n            case _d.left:\r\n                direction = dhlib.enums.PTZ.PTZ_LEFT;\r\n                break;\r\n            case _d.right:\r\n                direction = dhlib.enums.PTZ.PTZ_RIGHT;\r\n                break;\r\n            case _d.down:\r\n                direction = dhlib.enums.PTZ.PTZ_DOWN;\r\n                break;\r\n            default:{\r\n                if(callback)process.nextTick(()=>{\r\n                    callback('cmd unsupport');\r\n                });\r\n                return;\r\n            }\r\n        }\r\n        if(direction===dhlib.enums.PTZ.PTZ_UP||direction===dhlib.enums.PTZ.PTZ_DOWN){\r\n            this._PTZ(callback,this._loginID,this.nvr_channel,direction,this.v_speed);\r\n            return;\r\n        }\r\n        this._PTZ(callback,this._loginID,this.nvr_channel,direction,this.h_speed);\r\n    }\r\n    moveToPoint(pt,cb){\r\n        if(!this.isDemo){\r\n            if(callback)process.nextTick(()=> {\r\n                callback('not a demo');\r\n            });\r\n            return;\r\n        }\r\n        this._PTZ(cb,dhlib.enums.PTZ.PTZ_POINT_MOVE,pt,0);\r\n    }\r\n    setPoint(index,cb){\r\n        if(!this.isDemo){\r\n            if(callback)process.nextTick(()=> {\r\n                callback('not a demo');\r\n            });\r\n            return;\r\n        }\r\n        this._PTZ(cb,dhlib,enums.PTZ.PTZ_POINT_SET,index,0);\r\n    }\r\n}\r\n\r\nexports=module.exports=DHNVR;\r\n\r\n"]}