{"version":3,"sources":["../src/app.js"],"names":["app","Koa","use","cors","ctx","next","set","koaBody","multipart","strict","formidable","uploadDir","path","join","__dirname","jsonLimit","formLimit","textLimit","session","key","require","passport","initialize","router","routes","allowedMethods","listen","config","port","ip","logger","log","start","Parser","exports","module"],"mappings":";;;;;;AAgBA;AACA;;;0EAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACUA,2BADV,GACgB,IAAIC,GAAJ,EADhB;;;AAGID,4BAAIE,GAAJ,CAAQC,MAAR;;AAEAH,4BAAIE,GAAJ,CAAQ,UAACE,GAAD,EAAMC,IAAN,EAAe;AACnBD,gCAAIE,GAAJ,CAAQ,6BAAR,EAAuC,GAAvC;AACAF,gCAAIE,GAAJ,CAAQ,8BAAR,EAAwC,gDAAxC;AACAF,gCAAIE,GAAJ,CAAQ,8BAAR,EAAwC,iCAAxC;AACAF,gCAAIE,GAAJ,CAAQ,kCAAR,EAA4C,IAA5C,EAJmB,CAIgC;AACnD,mCAAOD,MAAP;AACH,yBAND,EAMGH,GANH,CAMOK,QAAQ;AACXC,uCAAW,IADA;AAEXC,oCAAQ,KAFG;AAGXC,wCAAY;AACRC,2CAAWC,KAAKC,IAAL,CAAUC,SAAV,EAAqB,uBAArB;AADH,6BAHD;AAMXC,uCAAW,MANA;AAOXC,uCAAW,MAPA;AAQXC,uCAAW;AARA,yBAAR,CANP;;AAiBJ;AACIjB,4BAAIE,GAAJ,CAAQgB,QAAQ;AACZC,iCAAK,WADO,CACQ;AADR,yBAAR,CAAR;AAGJ;AACIC,gCAAQ,+BAAR;AACJ;AACIpB,4BAAIE,GAAJ,CAAQmB,SAASC,UAAT,EAAR;AACAtB,4BAAIE,GAAJ,CAAQmB,SAASH,OAAT,EAAR;;AAEAlB,4BAAIE,GAAJ,CAAQqB,OAAOC,MAAP,EAAR,EACKtB,GADL,CACSqB,OAAOE,cAAP,EADT;;AAIJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AA9CA;AAAA,+BAiDUzB,IAAI0B,MAAJ,CAAWC,OAAOC,IAAlB,EAAwBD,OAAOE,EAA/B,CAjDV;;AAAA;;AAmDIC,+BAAOC,GAAP,CAAW,SAAX,EAAqB,EAACF,IAAGF,OAAOE,EAAX,EAAcD,MAAKD,OAAOC,IAA1B,EAArB;;AAnDJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAeI,K;;;;;;;;;AAnBf;;;AAGAZ,QAAQ,QAAR;AACA,IAAMR,OAAKQ,QAAQ,MAAR,CAAX;AACA,IAAMnB,MAAImB,QAAQ,KAAR,CAAV;AACA,IAAMC,WAASD,QAAQ,cAAR,CAAf;AACA,IAAMF,UAAQE,QAAQ,cAAR,CAAd;AACA,IAAMb,UAASa,QAAQ,UAAR,CAAf;;eACeA,QAAQ,WAAR,C;IAARa,M,YAAAA,M;;AACP,IAAMH,SAAQ,EAAd;AACAG,OAAOH,MAAP,EAAc,QAAd,EAAuB,EAAvB;AACA;AACA,IAAIH,SAAQP,QAAQ,gBAAR,CAAZ;AACA,IAAMG,SAAOH,QAAQ,UAAR,CAAb;AACA,IAAMjB,OAAKiB,QAAQ,WAAR,CAAX;AAyDAc,UAAQC,OAAOD,OAAP,GAAeF,KAAvB","file":"app.js","sourcesContent":["/**\r\n * Created by chen on 17-8-21.\r\n */\r\nrequire('./init');\r\nconst path=require('path');\r\nconst Koa=require('koa');\r\nconst passport=require('koa-passport');\r\nconst session=require('koa-session2');\r\nconst koaBody =require('koa-body');\r\nconst {Parser}=require('./log/log');\r\nconst logger ={};\r\nParser(logger,'app.js',{});\r\n//const connect=require('./db');\r\nlet config =require('./config/index');\r\nconst router=require('./router');\r\nconst cors=require('koa2-cors');\r\n//const StartUp =require('./servers/startup');\r\n//const vHost=require('./host/virtual_host');\r\n\r\nasync function start() {\r\n    const app = new Koa();\r\n\r\n    app.use(cors());\r\n\r\n    app.use((ctx, next) => {\r\n        ctx.set('Access-Control-Allow-Origin', '*');\r\n        ctx.set('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept');\r\n        ctx.set('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\r\n        ctx.set('Access-Control-Allow-Credentials', true); // 允许带上 cookie\r\n        return next();\r\n    }).use(koaBody({\r\n        multipart: true,\r\n        strict: false,\r\n        formidable: {\r\n            uploadDir: path.join(__dirname, '../assets/uploads/tmp')\r\n        },\r\n        jsonLimit: '10mb',\r\n        formLimit: '10mb',\r\n        textLimit: '10mb'\r\n    }));\r\n\r\n//session\r\n    app.use(session({\r\n        key: \"SESSIONID\",   //default \"koa:sess\"\r\n    }));\r\n// authentication\r\n    require('./controllers/auth/LDPassport');\r\n//passport\r\n    app.use(passport.initialize());\r\n    app.use(passport.session());\r\n\r\n    app.use(router.routes())\r\n        .use(router.allowedMethods());\r\n\r\n\r\n// const koaStatic = require('koa-static');\r\n//\r\n// app.use(koaStatic(\r\n//     path.join( __dirname,  './logs/monitors')\r\n// ))\r\n\r\n// app.use((ctx) => {\r\n//\r\n//     logger.info(\"server\");\r\n//     ctx.body = \"hello,world\";\r\n// });\r\n\r\n\r\n    await app.listen(config.port, config.ip);\r\n\r\n    logger.log('Web服务启动',{ip:config.ip,port:config.port});\r\n}\r\nexports=module.exports=start;"]}