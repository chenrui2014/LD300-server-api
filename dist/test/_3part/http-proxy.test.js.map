{"version":3,"sources":["../../../src/test/_3part/http-proxy.test.js"],"names":["http","require","httpProxy","proxy","createProxyServer","url","createServer","req","res","console","log","writeHead","write","JSON","stringify","headers","end","listen","uri","parse","pathname","indexOf","warn","setHeader","proxyPort","target","web","e","error","innerError"],"mappings":";;AAAA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,IAAMC,YAAWD,QAAQ,YAAR,CAAjB;AACA,IAAIE,QAAQD,UAAUE,iBAAV,EAAZ;AACA,IAAMC,MAAIJ,QAAQ,KAAR,CAAV;;AAEAD,KAAKM,YAAL,CAAkB,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAClCC,YAAQC,GAAR,gDAAsBH,IAAIF,GAA1B;AACAG,QAAIG,SAAJ,CAAc,GAAd,EAAmB,EAAE,gBAAgB,YAAlB,EAAnB;AACAH,QAAII,KAAJ,CAAU,sCAAsCL,IAAIF,GAA1C,GAAgD,IAAhD,GAAuDQ,KAAKC,SAAL,CAAeP,IAAIQ,OAAnB,EAA4B,IAA5B,EAAkC,CAAlC,CAAjE;AACAP,QAAIQ,GAAJ;AACH,CALD,EAKGC,MALH,CAKU,IALV;;AAOAjB,KAAKM,YAAL,CAAkB,UAACC,GAAD,EAAKC,GAAL,EAAY;AAC1BC,YAAQC,GAAR,oCAAoBH,IAAIF,GAAxB;AACA,QAAMa,MAAIb,IAAIc,KAAJ,CAAUZ,IAAIF,GAAd,CAAV;AACA,QAAGa,IAAIE,QAAJ,CAAaC,OAAb,CAAqB,OAArB,MAAgC,CAAnC,EAAqC;AACjC,kBAAKC,IAAL,CAAU,QAAV,EAAmB,EAACJ,QAAD,EAAnB;AACAV,YAAIe,SAAJ,CAAc,cAAd,EAA6B,iCAA7B;AACAf,YAAIG,SAAJ,CAAc,GAAd,EAAmB,EAAC,gBAAgB,YAAjB,EAAnB;AACAH,YAAII,KAAJ,CAAU,QAAV;AACA,eAAOJ,IAAIQ,GAAJ,EAAP;AACH;AACD,QAAIQ,YAAU,KAAd;AACA;AACA;AACA;AACA,QAAMC,SAAO,EAAEA,8BAA4BD,SAA9B,EAAb;AACArB,UAAMuB,GAAN,CAAUnB,GAAV,EAAeC,GAAf,EAAmBiB,MAAnB,EAA2B,UAACE,CAAD,EAAK;AAC5B,kBAAKC,KAAL,CAAW,MAAX,EAAkB,EAACC,YAAWF,CAAZ,EAAcF,cAAd,EAAlB;AACH,KAFD;AAGH,CAlBD,EAkBGR,MAlBH,CAkBU,IAlBV","file":"http-proxy.test.js","sourcesContent":["const http = require('http');\r\nconst httpProxy =require('http-proxy');\r\nlet proxy = httpProxy.createProxyServer();\r\nconst url=require('url');\r\n\r\nhttp.createServer(function (req, res) {\r\n    console.log(`收到转发请求：${req.url}`);\r\n    res.writeHead(200, { 'Content-Type': 'text/plain' });\r\n    res.write('request successfully proxied to: ' + req.url + '\\n' + JSON.stringify(req.headers, true, 2));\r\n    res.end();\r\n}).listen(9008);\r\n\r\nhttp.createServer((req,res)=> {\r\n    console.log(`收到请求：${req.url}`);\r\n    const uri=url.parse(req.url);\r\n    if(uri.pathname.indexOf('/ipc/')!==0){\r\n        this.warn('收到未知请求',{uri});\r\n        res.setHeader('Content-Type','application/json; charset=utf-8');\r\n        res.writeHead(404, {'Content-Type': 'text/plain'});\r\n        res.write(\"服务未找到!\");\r\n        return res.end();\r\n    }\r\n    let proxyPort=41074;\r\n    //this.log('请求转发',{'Location': `http://localhost:${proxyPort}` + req.url});\r\n    //res.writeHead(302, {'Location': `http://localhost:${worker.port}` + req.url});\r\n    //res.end();\r\n    const target={ target: `http://localhost:${proxyPort}` };\r\n    proxy.web(req, res,target ,(e)=>{\r\n        this.error('转发出错',{innerError:e,target})\r\n    });\r\n}).listen(3000);"]}