{"version":3,"sources":["../../../src/test/flv/h264_2flv.format.test.js"],"names":["require","IPCFactory","H264_2Flv","H254_2Flv_Ffmpeg","fs","wOption","flags","encoding","fd","mode","autoClose","describe","it","done","getIPC","ipc","convert","f1","createWriteStream","f2","f3","addClient","data","write","convert2","on","toString","writeVedio","realPlay","then","console","log","setTimeout","stopRealPlay","catch","close"],"mappings":";;;;;;;;;;AAAAA,QAAQ,kBAAR;AACA,IAAMC,aAAWD,QAAQ,+BAAR,CAAjB;AACA,IAAME,YAAUF,QAAQ,sCAAR,CAAhB;AACA,IAAMG,mBAAiBH,QAAQ,sCAAR,CAAvB;AACA,IAAII,KAAGJ,QAAQ,IAAR,CAAP;AACA,IAAMK,UAAU;AACZC,WAAO,GADK;AAEZC,cAAU,IAFE;AAGZC,QAAI,IAHQ;AAIZC,UAAM,GAJM;AAKZC,eAAW;AALC,CAAhB;;AAQAC,SAAS,mBAAT,EAA6B,YAAI;AAC7BC,OAAG,EAAH;AAAA,8EAAM,iBAAOC,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mCAGcZ,WAAWa,MAAX,CAAkB,CAAlB,CAHd;;AAAA;AAGIC,+BAHJ;AAIEC,mCAJF,GAIU,IAAId,SAAJ,CAAc,IAAd,EAAmB,KAAnB,CAJV;AAKEe,8BALF,GAKKb,GAAGc,iBAAH,CAAqB,iBAArB,EAAuCb,OAAvC,CALL;AAMEc,8BANF,GAMKf,GAAGc,iBAAH,CAAqB,wBAArB,EAA8Cb,OAA9C,CANL;AAOEe,8BAPF,GAOKhB,GAAGc,iBAAH,CAAqB,qBAArB,EAA2Cb,OAA3C,CAPL;;AAQFW,oCAAQK,SAAR,CAAkB,UAACC,IAAD,EAAQ;AACvBL,mCAAGM,KAAH,CAASD,IAAT;AACF,6BAFD;AAGIE,oCAXF,GAWW,IAAIrB,gBAAJ,CAAqB,EAAC,SAAQ,KAAT,EAAe,SAAQ,MAAvB,EAArB,CAXX;;AAYFqB,qCAASC,EAAT,CAAY,MAAZ,EAAmB,UAACH,IAAD,EAAQ;AACvBH,mCAAGI,KAAH,CAASD,IAAT;AACH,6BAFD;AAGAP,gCAAIU,EAAJ,CAAO,OAAP,EAAe,UAACH,IAAD,EAAQ;AACnBF,mCAAGG,KAAH,CAASD,KAAKI,QAAL,CAAc,KAAd,IAAqB,IAA9B;AACAV,wCAAQO,KAAR,CAAcD,IAAd;AACAE,yCAASG,UAAT,CAAoBL,IAApB;AACH,6BAJD;;AAMAP,gCAAIa,QAAJ,GAAeC,IAAf,CAAoB,YAAI;AACpBC,wCAAQC,GAAR,CAAY,KAAZ;AACAC,2CAAW,YAAI;AACXjB,wCAAIkB,YAAJ,GAAmBJ,IAAnB,CAAwBhB,IAAxB,EAA8BqB,KAA9B,CAAoCrB,IAApC;AACAI,uCAAGkB,KAAH;AACAhB,uCAAGgB,KAAH;AACAf,uCAAGe,KAAH;AACH,iCALD,EAKE,KALF;AAMH,6BARD,EAQGD,KARH,CAQSrB,IART;;AArBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAN;;AAAA;AAAA;AAAA;AAAA;AA+BH,CAhCD","file":"h264_2flv.format.test.js","sourcesContent":["require('../modify_config');\r\nconst IPCFactory=require('../../app/servers/ipc_factory');\r\nconst H264_2Flv=require('../../app/servers/cache/to_flv_cache');\r\nconst H254_2Flv_Ffmpeg=require('../../app/_ffmpeg/stream_ffmpeg_pipe');\r\nlet fs=require('fs');\r\nconst wOption = {\r\n    flags: 'w',\r\n    encoding: null,\r\n    fd: null,\r\n    mode: 0o666,\r\n    autoClose: true\r\n};\r\n\r\ndescribe('ffmpeg及h264打包格式对比',()=>{\r\n    it('',async (done)=>{\r\n/*        console.log(process.env)\r\n        return done();*/\r\n        const ipc=await IPCFactory.getIPC(1);\r\n        let convert=new H264_2Flv(true,false);\r\n        let f1=fs.createWriteStream('d:/ipc_h264.flv',wOption);\r\n        let f2=fs.createWriteStream('d:/ipc_h264_ffmpeg.flv',wOption);\r\n        let f3=fs.createWriteStream('d:/ipc_h264_hex.txt',wOption);\r\n        convert.addClient((data)=>{\r\n           f1.write(data);\r\n        });\r\n        let convert2=new H254_2Flv_Ffmpeg({'audio':false,'codec':'copy'});\r\n        convert2.on('data',(data)=>{\r\n            f2.write(data);\r\n        });\r\n        ipc.on('video',(data)=>{\r\n            f3.write(data.toString('hex')+'\\r');\r\n            convert.write(data);\r\n            convert2.writeVedio(data);\r\n        });\r\n\r\n        ipc.realPlay().then(()=>{\r\n            console.log('已启动');\r\n            setTimeout(()=>{\r\n                ipc.stopRealPlay().then(done).catch(done);\r\n                f1.close();\r\n                f2.close();\r\n                f3.close();\r\n            },10000);\r\n        }).catch(done);\r\n    });\r\n});"]}