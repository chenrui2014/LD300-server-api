{"version":3,"sources":["../../src/test/rtsp_heartbeat.test.js"],"names":["HB","require","ONVIF","cfg","expect","RtspClient","describe","xit","done","ipc","_realPlay","then","uri","client","connect","keepAlive","details","setTimeout","console","log","catch","it","hb","listen","i","on","e","error"],"mappings":";;AAAA;;;;AAIA,IAAMA,KAAGC,QAAQ,4BAAR,CAAT;AACA,IAAMC,QAAMD,QAAQ,6BAAR,CAAZ;AACA,IAAME,MAAIF,QAAQ,yBAAR,CAAV;AACA,IAAMG,SAASH,QAAQ,MAAR,EAAgBG,MAA/B;AACA,IAAMC,aAAWJ,QAAQ,uBAAR,EAAiCI,UAAlD;;AAGAC,SAAS,UAAT,EAAoB,YAAK;;AAErBC,QAAI,eAAJ,EAAoB,UAACC,IAAD,EAAQ;AACxB,YAAIC,MAAM,IAAIP,KAAJ,CAAUC,GAAV,CAAV;AACAM,YAAIC,SAAJ,GAAgBC,IAAhB,CAAqB,UAACC,GAAD,EAAQ;AACzB,gBAAIC,SAAO,IAAIR,UAAJ,CAAe,OAAf,EAAuB,OAAvB,CAAX;AACAQ,mBAAOC,OAAP,CAAeF,GAAf,EAAoB,EAAEG,WAAW,IAAb,EAApB,EAAyCJ,IAAzC,CAA8C,UAACK,OAAD,EAAW;AACrDC,2BAAWT,IAAX,EAAgB,IAAhB;AACAU,wBAAQC,GAAR,CAAYH,OAAZ;AACH,aAHD,EAGGI,KAHH,CAGSZ,IAHT;AAIH,SAND,EAMGY,KANH,CAMSZ,IANT;AAOH,KATD;;AAWAa,OAAG,KAAH,EAAU,UAACb,IAAD,EAAU;AAChB,YAAIC,MAAM,IAAIP,KAAJ,CAAUC,GAAV,CAAV;AACAM,YAAIC,SAAJ,GAAgBC,IAAhB,CAAqB,UAACC,GAAD,EAAQ;AACzBM,oBAAQC,GAAR,CAAY,gBAAZ;AACA,gBAAIG,KAAG,IAAItB,EAAJ,CAAOY,GAAP,EAAW,OAAX,EAAmB,OAAnB,CAAP;AACIU,eAAGC,MAAH;AACJ,gBAAIC,IAAE,CAAN;AACAF,eAAGG,EAAH,CAAM,QAAN,EAAe,YAAI;AACfD;AACA,oBAAGA,MAAI,EAAP,EAAUhB;AACVU,wBAAQC,GAAR,CAAY,MAAZ;AACH,aAJD;AAKA;AACAG,eAAGG,EAAH,CAAM,SAAN,EAAgB,UAACC,CAAD,EAAK;AACjBF;AACAN,wBAAQS,KAAR,CAAc,MAAd;AACAnB,qBAAKkB,CAAL;AACH,aAJD;AAKH,SAhBD,EAgBGN,KAhBH,CAgBSZ,IAhBT;AAiBH,KAnBD;AAoBH,CAjCD","file":"rtsp_heartbeat.test.js","sourcesContent":["/**\r\n * Created by Luky on 2017/7/17.\r\n */\r\n\r\nconst HB=require('../app/rtsp/rtsp_heartbeat');\r\nconst ONVIF=require('../app/ipcs/onvif/onvif_ipc');\r\nconst cfg=require('./data/dhipc_onvif.json');\r\nconst expect = require('chai').expect;\r\nconst RtspClient=require('../_3part/yellowstone').RtspClient;\r\n\r\n\r\ndescribe('RTSP心跳测试',()=> {\r\n\r\n    xit('yellowstone测试',(done)=>{\r\n        let ipc = new ONVIF(cfg);\r\n        ipc._realPlay().then((uri)=> {\r\n            let client=new RtspClient('admin','admin');\r\n            client.connect(uri, { keepAlive: true }).then((details)=>{\r\n                setTimeout(done,2000);\r\n                console.log(details);\r\n            }).catch(done);\r\n        }).catch(done);\r\n    });\r\n\r\n    it('abc', (done) => {\r\n        let ipc = new ONVIF(cfg);\r\n        ipc._realPlay().then((uri)=> {\r\n            console.log('rtsp地址取回成功链接成功');\r\n            let hb=new HB(uri,'admin','admin');\r\n                hb.listen();\r\n            let i=0;\r\n            hb.on('online',()=>{\r\n                i++;\r\n                if(i===10)done();\r\n                console.log('服务在线')\r\n            });\r\n            //手动拔网线测试\r\n            hb.on('offline',(e)=>{\r\n                i++;\r\n                console.error('服务掉线');\r\n                done(e);\r\n            });\r\n        }).catch(done);\r\n    });\r\n});"]}