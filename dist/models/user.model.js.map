{"version":3,"sources":["../../src/models/user.model.js"],"names":["mongoose","require","validate","validator","UserSchema","Schema","id","type","String","unique","isRequired","index","username","required","arguments","password","v","isModified","isLength","min","message","sex","enum","address","email","passIfEmpty","salt","timestamps","versionKey","virtual","get","_id","module","exports","model"],"mappings":";;AAAA;;;AAGA;AACA;AACA;;AAEA,IAAMA,WAAUC,QAAQ,UAAR,CAAhB;AACA,IAAMC,WAASD,QAAQ,oBAAR,CAAf;AACA,IAAME,aAAUF,QAAQ,WAAR,CAAhB;;AAEA,IAAMG,aAAa,IAAIJ,SAASK,MAAb,CAAoB;AACnCC,QAAG;AACCC,cAAKC,MADN;AAECC,gBAAO,IAFR;AAGCC,oBAAW,IAHZ;AAICC,eAAM,EAACF,QAAO,IAAR;AAJP,KADgC;AAOnCG,cAAS;AACLL,cAAKC,MADA;AAELC,gBAAO,IAFF;AAGLI,kBAAS,IAHJ;AAILV,mBAAUD,SAAS;AACfC,uBAAW,UADI;AAEfW,uBAAW,CAAC,CAAD,EAAI,EAAJ;AAFI,SAAT,CAJL;AAQLH,eAAO,EAAEF,QAAQ,IAAV;AARF,KAP0B;AAiBnCM,cAAS;AACLR,cAAKC,MADA;AAELK,kBAAS,IAFJ;AAGLX,kBAAU;AACNC,qBADM,qBACIa,CADJ,EACO;AACT,oBAAI,KAAKC,UAAL,CAAgB,UAAhB,CAAJ,EAAiC;AAC7B,2BAAOd,WAAUe,QAAV,CAAmBF,CAAnB,EAAsB,EAACG,KAAK,CAAN,EAAtB,CAAP;AACH;AACD,uBAAO,IAAP;AACH,aANK;;AAONC,qBAAS;AAPH;AAHL,KAjB0B;AA8BnCC,SAAK;AACDd,cAAMC,MADL;AAEDc,cAAM,CAAC,GAAD,EAAM,GAAN;AAFL,KA9B8B;AAkCnCC,aAAS;AACLhB,cAAMC,MADD;AAELN,kBAAUA,SAAS,EAAEC,WAAW,UAAb,EAAyBW,WAAW,CAAC,CAAD,EAAI,GAAJ,CAApC,EAAT;AAFL,KAlC0B;AAsCnCU,WAAO;AACHjB,cAAMC,MADH;AAEHN,kBAAUA,SAAS,EAAEC,WAAW,SAAb,EAAwBsB,aAAa,IAArC,EAAT;AAFP,KAtC4B;AA0CnCC,UAAMlB;AA1C6B,CAApB,EA2ChB;AACCmB,gBAAY,IADb;AAECC,gBAAY;AAFb,CA3CgB,CAAnB;;AAgDAxB,WACKyB,OADL,CACa,SADb,EAEKC,GAFL,CAES,YAAY;AACb,WAAO;AACHC,aAAK,KAAKzB,EADP;AAEHM,kBAAU,KAAKA,QAFZ;AAGHS,aAAK,KAAKA,GAHP;AAIHG,eAAO,KAAKA,KAJT;AAKHD,iBAAS,KAAKA;AALX,KAAP;AAOH,CAVL;;AAYAnB,WACKyB,OADL,CACa,MADb,EAEKC,GAFL,CAES,YAAY;AACb,WAAO;AACHC,aAAK,KAAKzB,EADP;AAEHM,kBAAU,KAAKA;AAFZ,KAAP;AAIH,CAPL;;AASAoB,OAAOC,OAAP,GAAiBjC,SAASkC,KAAT,CAAe,MAAf,EAAuB9B,UAAvB,CAAjB","file":"user.model.js","sourcesContent":["/**\r\n * Created by chen on 17-8-22.\r\n */\r\n//import mongoose from 'mongoose';\r\n//import validate from 'mongoose-validator';\r\n//import validator from 'validator';\r\n\r\nconst mongoose =require('mongoose');\r\nconst validate=require('mongoose-validator');\r\nconst validator=require('validator');\r\n\r\nconst UserSchema = new mongoose.Schema({\r\n    id:{\r\n        type:String,\r\n        unique:true,\r\n        isRequired:true,\r\n        index:{unique:true}\r\n    },\r\n    username:{\r\n        type:String,\r\n        unique:true,\r\n        required:true,\r\n        validator:validate({\r\n            validator: 'isLength',\r\n            arguments: [2, 15],\r\n        }),\r\n        index: { unique: true },\r\n    },\r\n    password:{\r\n        type:String,\r\n        required:true,\r\n        validate: {\r\n            validator(v) {\r\n                if (this.isModified('password')) {\r\n                    return validator.isLength(v, {min: 6});\r\n                }\r\n                return true;\r\n            },\r\n            message: '密码至少为６位',\r\n        }\r\n    },\r\n    sex: {\r\n        type: String,\r\n        enum: ['M', 'F'],\r\n    },\r\n    address: {\r\n        type: String,\r\n        validate: validate({ validator: 'isLength', arguments: [0, 128] }),\r\n    },\r\n    email: {\r\n        type: String,\r\n        validate: validate({ validator: 'isEmail', passIfEmpty: true }),\r\n    },\r\n    salt: String,\r\n}, {\r\n    timestamps: true,\r\n    versionKey: false,\r\n});\r\n\r\nUserSchema\r\n    .virtual('profile')\r\n    .get(function () {\r\n        return {\r\n            _id: this.id,\r\n            username: this.username,\r\n            sex: this.sex,\r\n            email: this.email,\r\n            address: this.address,\r\n        };\r\n    });\r\n\r\nUserSchema\r\n    .virtual('info')\r\n    .get(function () {\r\n        return {\r\n            _id: this.id,\r\n            username: this.username,\r\n        };\r\n    });\r\n\r\nmodule.exports = mongoose.model('User', UserSchema);"]}