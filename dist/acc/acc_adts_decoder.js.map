{"version":3,"sources":["../../src/acc/acc_adts_decoder.js"],"names":["Writable","require","Parser","inherits","AdtsParser","AdtsDecoder","call","adts","_bytes","_onAdtsHeader","size","prototype","buf","ParseADTSHeader","emit","protection_absent","_skipBytes","acc_raw_data_length","_onRawData","rowData","cb","exports","module"],"mappings":";;AAAA;;;;AAIA,IAAMA,WAAUC,QAAQ,QAAR,EAAkBD,QAAlC;AACA,IAAME,SAASD,QAAQ,eAAR,CAAf;AACA,IAAME,WAAWF,QAAQ,MAAR,EAAgBE,QAAjC;AACA,IAAMC,aAAWH,QAAQ,mBAAR,CAAjB;;AAEA,SAASI,WAAT,GAAuB;AACnB,QAAI,EAAE,gBAAgBA,WAAlB,CAAJ,EAAoC,OAAO,IAAIA,WAAJ,EAAP;AACpCL,aAASM,IAAT,CAAc,IAAd;AACA;AACA,SAAKC,IAAL,GAAU,IAAV;AACA,SAAKC,MAAL,CAAY,CAAZ,EAAe,KAAKC,aAApB;AACA,SAAKC,IAAL,GAAU,CAAV;AACH;;AAEDP,SAASE,WAAT,EAAsBL,QAAtB;AACA;;;;AAIAE,OAAOG,YAAYM,SAAnB;;AAEAN,YAAYM,SAAZ,CAAsBF,aAAtB,GAAoC,UAAUG,GAAV,EAAe;AAC/C,QAAIL,OAAKH,WAAWS,eAAX,CAA2BD,GAA3B,CAAT;AACA,QAAG,KAAKL,IAAL,KAAY,IAAf,EAAoB;AAChB,aAAKA,IAAL,GAAUA,IAAV;AACA,aAAKO,IAAL,CAAU,MAAV,EAAiBF,GAAjB;AACH;AACD,QAAG,CAACL,KAAKQ,iBAAT,EAA4B,KAAKC,UAAL,CAAgB,CAAhB;AAC5B;;AAEA,SAAKR,MAAL,CAAYD,KAAKU,mBAAjB,EAAqC,KAAKC,UAA1C;AACH,CAVD;;AAYAb,YAAYM,SAAZ,CAAsBO,UAAtB,GAAiC,UAAUC,OAAV,EAAkBC,EAAlB,EAAsB;AACnD,SAAKZ,MAAL,CAAY,CAAZ,EAAe,KAAKC,aAApB;AACA,SAAKK,IAAL,CAAU,MAAV,EAAiBK,OAAjB;AACA;AACAC;AACH,CALD;AAMA;;;;;;AAMAC,UAAQC,OAAOD,OAAP,GAAehB,WAAvB","file":"acc_adts_decoder.js","sourcesContent":["/**\r\n * Created by Luky on 2017/8/30.\r\n */\r\n\r\nconst Writable= require('stream').Writable;\r\nconst Parser = require('stream-parser');\r\nconst inherits = require('util').inherits;\r\nconst AdtsParser=require('./acc_adts_parser');\r\n\r\nfunction AdtsDecoder() {\r\n    if (!(this instanceof AdtsDecoder)) return new AdtsDecoder();\r\n    Writable.call(this);\r\n    //this.on('finish',this._onfinish);\r\n    this.adts=null;\r\n    this._bytes(7, this._onAdtsHeader);\r\n    this.size=0;\r\n}\r\n\r\ninherits(AdtsDecoder, Writable);\r\n/**\r\n * Mixin `Parser`.\r\n */\r\n\r\nParser(AdtsDecoder.prototype);\r\n\r\nAdtsDecoder.prototype._onAdtsHeader=function (buf) {\r\n    let adts=AdtsParser.ParseADTSHeader(buf);\r\n    if(this.adts===null){\r\n        this.adts=adts;\r\n        this.emit('adts',buf);\r\n    }\r\n    if(!adts.protection_absent) this._skipBytes(2);\r\n    /*console.log(this.size.toString(16));\r\n    console.log(buf.toString('hex'));*/\r\n    this._bytes(adts.acc_raw_data_length,this._onRawData);\r\n};\r\n\r\nAdtsDecoder.prototype._onRawData=function (rowData,cb) {\r\n    this._bytes(7, this._onAdtsHeader);\r\n    this.emit('data',rowData);\r\n    //this.size+=rowData.length+7;\r\n    cb();\r\n};\r\n/*\r\nAdtsDecoder.prototype._onfinish=function () {\r\n\r\n};\r\n*/\r\n\r\nexports=module.exports=AdtsDecoder;\r\n\r\n"]}