{"version":3,"sources":["../../src/controllers/perimeterController.js"],"names":["require","Parser","logger","PerimeterController","ctx","data","request","body","info","msg","findOne","ip","fields","isExit","perimeter","save","err","name","id","params","findByIdAndRemove","exec","result","error","update","find"],"mappings":";;;;;;;;;;;;AAMA;;;;;;;;;;AANA;;;eAGeA,QAAQ,YAAR,C;IAARC,M,YAAAA,M;;AACP,IAAMC,SAAO,EAAb;AACAD,OAAOC,MAAP,EAAc,wBAAd;;IAGMC,mB;;;;;;;;mGACyBC,G;;;;;;AACjBC,oC,GAAOD,IAAIE,OAAJ,CAAYC,I;;AACzBL,uCAAOM,IAAP,CAAYH,IAAZ;;oCACIA,I;;;;;iEAAaD,IAAIG,IAAJ,GAAS,EAAEE,KAAK,SAAP,E;;;;uCACL,oBAAeC,OAAf,CAAuB,EAACC,IAAGN,KAAKO,MAAL,CAAYD,EAAhB,EAAvB,C;;;AAAfE,sC;;AACNX,uCAAOM,IAAP,CAAYK,MAAZ;;qCACGA,M;;;;;iEAAeT,IAAIG,IAAJ,GAAS,EAAEE,KAAK,QAAP,E;;;AAEvBK,yC,GAAY,wBAAmBT,KAAKO,MAAxB,C;;AAChBV,uCAAOM,IAAP,CAAYM,SAAZ;AACIL,mC,GAAM,E;;AACVK,0CAAUC,IAAV,CAAe,UAAUC,GAAV,EAAcF,SAAd,EAAyB;AACpC,wCAAG,CAACE,GAAJ,EAAS;AACLP,8CAAM,SAAQK,UAAUG,IAAlB,GAAwB,IAA9B;AACH,qCAFD,MAEK;AACDR,8CAAMO,GAAN;AACH;AACJ,iCAND;;iEAQOZ,IAAIG,IAAJ,GAAW,EAACE,KAAIA,GAAL,EAASJ,MAAKS,SAAd,E;;;;;;;;;;;;;;;;;;;qGAGQV,G;;;;;;AAClBc,kC,GAAOd,IAAIe,M,CAAXD,E;;AACRhB,uCAAOM,IAAP,CAAYU,EAAZ;;uCACqB,oBAAeE,iBAAf,CAAiCF,EAAjC,EAAqCG,IAArC,E;;;AAAfC,sC;;oCACFA,M;;;;;kEAAelB,IAAImB,KAAJ,GAAU,EAACd,KAAK,SAAN,E;;;kEACtBL,IAAIG,IAAJ,GAAW,EAACE,KAAI,QAAL,EAAcJ,MAAKiB,MAAnB,E;;;;;;;;;;;;;;;;;;;qGAGMlB,G;;;;;;AAClBC,oC,GAAOD,IAAIE,OAAJ,CAAYC,I;;AACzBL,uCAAOM,IAAP,CAAYH,IAAZ;;uCACqB,oBAAemB,MAAf,CAAsBnB,IAAtB,EAA2B,EAACa,IAAGb,KAAKa,EAAT,EAA3B,EAAyCG,IAAzC,E;;;AAAfC,sC;;oCACFA,M;;;;;kEAAelB,IAAImB,KAAJ,GAAU,EAACd,KAAK,SAAN,E;;;kEACtBL,IAAIG,IAAJ,GAAW,EAACE,KAAI,QAAL,EAAcJ,MAAKiB,MAAnB,E;;;;;;;;;;;;;;;;;;;qGAGMlB,G;;;;;;;uCACH,oBAAeqB,IAAf,GAAsBJ,IAAtB,E;;;AAAfC,sC;;oCACFA,M;;;;;kEAAelB,IAAIG,IAAJ,GAAS,EAACE,KAAK,SAAN,E;;;kEACrBL,IAAIG,IAAJ,GAAW,EAACE,KAAI,MAAL,EAAYJ,MAAKiB,MAAjB,E;;;;;;;;;;;;;;;;;;;qGAEAlB,G;;;;;;AACVc,kC,GAAOd,IAAIe,M,CAAXD,E;;uCACa,oBAAeR,OAAf,CAAuB,EAACQ,IAAGA,EAAJ,EAAvB,EAAgCG,IAAhC,E;;;AAAfC,sC;;oCACFA,M;;;;;kEAAelB,IAAIG,IAAJ,GAAW,EAACE,KAAK,SAAN,E;;;kEACvBL,IAAIG,IAAJ,GAAW,EAACE,KAAI,MAAL,EAAYJ,MAAKiB,MAAjB,E;;;;;;;;;;;;;;;;;;;;;kBAKXnB,mB","file":"perimeterController.js","sourcesContent":["/**\r\n * Created by chen on 17-8-23.\r\n */\r\nconst {Parser}=require('../log/log');\r\nconst logger={};\r\nParser(logger,'PerimeterController.js');\r\nimport PerimeterModel from '../models/perimeter.model';\r\n\r\nclass PerimeterController {\r\n    static async add_perimeter(ctx){\r\n        const data = ctx.request.body;\r\n        logger.info(data);\r\n        if(!data) return ctx.body={ msg: '发送数据失败!' };\r\n        const isExit = await PerimeterModel.findOne({ip:data.fields.ip});\r\n        logger.info(isExit);\r\n        if(isExit) return ctx.body={ msg: '周界已添加!' };\r\n\r\n        let perimeter = new PerimeterModel(data.fields);\r\n        logger.info(perimeter);\r\n        let msg = '';\r\n        perimeter.save(function (err,perimeter) {\r\n            if(!err) {\r\n                msg = '添加周界'+ perimeter.name +'成功';\r\n            }else{\r\n                msg = err;\r\n            }\r\n        });\r\n\r\n        return ctx.body = {msg:msg,data:perimeter};\r\n    }\r\n\r\n    static async delete_perimeter(ctx) {\r\n        const { id } = ctx.params;\r\n        logger.info(id);\r\n        const result = await PerimeterModel.findByIdAndRemove(id).exec();\r\n        if(!result) return ctx.error={msg: '删除周界失败!'};\r\n        return ctx.body = {msg:'删除周界成功',data:result};\r\n    }\r\n\r\n    static async edit_perimeter(ctx){\r\n        const data = ctx.request.body;\r\n        logger.info(data);\r\n        const result = await PerimeterModel.update(data,{id:data.id}).exec();\r\n        if(!result) return ctx.error={msg: '修改周界失败!'};\r\n        return ctx.body = {msg:'修改周界成功',data:result};\r\n    }\r\n\r\n    static async find_perimeter(ctx){\r\n        const result = await PerimeterModel.find().exec();\r\n        if(!result) return ctx.body={msg: '没有找到周界!'};\r\n        return ctx.body = {msg:'查询周界',data:result};\r\n    }\r\n    static async find_one(ctx){\r\n        const { id } = ctx.params;\r\n        const result = await PerimeterModel.findOne({id:id}).exec();\r\n        if(!result) return ctx.body = {msg: '没有找到周界!'};\r\n        return ctx.body = {msg:'查询周界',data:result};\r\n    }\r\n\r\n}\r\n\r\nexport default PerimeterController;"]}