{"version":3,"sources":["../../src/controllers/monitoringAreaController.js"],"names":["MonitoringAreaController","ctx","data","request","body","info","msg","add_monitoringArea","result","error","id","params","delete_monitoringArea","_id","edit_monitoringArea","query","sort","range","filter","sortObj","JSON","parse","rangeObj","filterObj","sortP","length","pageStart","pageEnd","getTotal","total","pagination","pageSize","find_monitoringArea","findAll","hosts","forEach","e","host","_doc","hostId","hostName","cameras","camera","cameraId","cameraName","name","find_one"],"mappings":"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","file":"monitoringAreaController.js","sourcesContent":["/**\n * Created by chen on 17-8-23.\n */\nimport logger from '../logger';\nimport MonitoringService from '../services/monitoringService';\nimport HostService from '../services/hostService';\nimport CameraService from '../services/cameraService';\n\nclass MonitoringAreaController {\n    static async add_monitoringArea(ctx){\n        const data = ctx.request.body;\n        logger.info(data);\n        if(!data) return ctx.body={ msg: '发送数据失败!' };\n        //const isExit = await MonitoringService.isExist(id).add_monitoringArea(data).findOne({ip:data.fields.ip});\n        //logger.info(isExit);\n        //if(isExit) return ctx.body={ msg: '该监控区域已添加!' };\n\n        const result = await MonitoringService.add_monitoringArea(data);\n        let msg = '';\n        if(result) {\n            msg = '添加监控区域成功';\n            return ctx.body = {msg:msg,data:data};\n        }else{\n            msg = '添加监控区域失败';\n            return ctx.error={msg: msg};\n        }\n    }\n\n    static async delete_monitoringArea(ctx) {\n        const { id } = ctx.params;\n        logger.info(id);\n        const result = await MonitoringService.delete_monitoringArea({id:id});\n        let msg = '';\n        if(result) {\n            msg = '删除摄像头成功';\n            return ctx.body = {msg:msg,data:result};\n        }else{\n            msg = '删除摄像头失败';\n            return ctx.error={msg: msg};\n        }\n    }\n\n    static async edit_monitoringArea(ctx){\n        const data = ctx.request.body;\n        logger.info(data);\n        let _id = data._id;\n        delete data._id;\n        const result = await MonitoringService.edit_monitoringArea({_id:_id},data);\n        if(result) ctx.body = {msg:'修改监控区域成功',data:result};\n        return ctx.error={msg: '修改监控区域失败!'};\n    }\n\n    static async find_monitoringArea(ctx){\n        const { sort,range,filter } = ctx.query;\n        let sortObj = JSON.parse(sort);\n        let rangeObj = JSON.parse(range);\n        let filterObj = JSON.parse(filter);\n        let sortP = {};\n        if(sortObj && sortObj.length >=2){\n            if('ASC' ===sortObj[1]){\n                sortP[sortObj[0]] = 1\n            }else{\n                sortP[sortObj[0]] = -1\n            }\n        }\n\n        let pageStart = 0,pageEnd = 0\n        if(rangeObj && rangeObj.length >=2){\n            pageStart = rangeObj[0];\n            pageEnd = rangeObj[1];\n        }\n\n\n        const total = await MonitoringService.getTotal();\n\n        const pagination = {};\n        pagination.pageStart = pageStart;\n        pagination.pageSize = pageEnd-pageStart+1;\n\n        let result = await MonitoringService.find_monitoringArea(filterObj,sortP,pagination);\n        const hosts = await HostService.findAll();\n\n        result.forEach(function (e) {\n            hosts.forEach(function (host) {\n                if(e._doc.hostId === host._doc.id) e._doc.hostName = host._doc.hostName;\n                return;\n            });\n        });\n        const cameras = await CameraService.findAll();\n\n        result.forEach(function (e) {\n            cameras.forEach(function (camera) {\n                if(e._doc.cameraId === camera._doc.id) e._doc.cameraName = camera._doc.name;\n                return;\n            });\n        });\n        if(result) return ctx.body = {msg:'查询监控区域',data:result,total:total};\n        return ctx.body={msg: '没有找到监控区域!'};\n    }\n\n    static async find_monitoringArea_noPage(ctx){\n        const { sort} = ctx.query;\n        let sortObj = JSON.parse(sort);\n        let sortP = {};\n        if(sortObj && sortObj.length >=2){\n            if('ASC' ===sortObj[1]){\n                sortP[sortObj[0]] = 1\n            }else{\n                sortP[sortObj[0]] = -1\n            }\n        }\n        let result = await MonitoringService.findAll(sortP);\n        const hosts = await HostService.findAll();\n\n        result.forEach(function (e) {\n            hosts.forEach(function (host) {\n                if(e._doc.hostId === host._doc.id) e._doc.hostName = host._doc.hostName;\n                return;\n            });\n        });\n        const cameras = await CameraService.findAll();\n\n        result.forEach(function (e) {\n            cameras.forEach(function (camera) {\n                if(e._doc.cameraId === camera._doc.id) e._doc.cameraName = camera._doc.name;\n                return;\n            });\n        });\n        if(result) return ctx.body = {msg:'查询监控区域',data:result};\n        return ctx.error={msg: '没有找到监控区域!'};\n    }\n    static async find_one(ctx){\n        const { id } = ctx.params;\n        const result = await MonitoringService.find_one(id);\n        const hosts = await HostService.findAll();\n\n        result.forEach(function (e) {\n            hosts.forEach(function (host) {\n                if(e._doc.hostId === host._doc.id) e._doc.hostName = host._doc.hostName;\n                return;\n            });\n        });\n        const cameras = await CameraService.findAll();\n\n        result.forEach(function (e) {\n            cameras.forEach(function (camera) {\n                if(e._doc.cameraId === camera._doc.id) e._doc.cameraName = camera._doc.name;\n                return;\n            });\n        });\n        if(result) return ctx.body = {msg:'查询监控区域',data:result};\n        return ctx.body = {msg: '没有找到监控区域!'};\n    }\n\n}\n\nexport default MonitoringAreaController;"]}