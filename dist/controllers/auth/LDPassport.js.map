{"version":3,"sources":["../../../src/controllers/auth/LDPassport.js"],"names":["serializeUser","user","done","id","deserializeUser","findById","then","get","errors","use","usernameField","passwordField","passReqToCallback","req","username","password","findOne","attributes","where","message","catch"],"mappings":";;AAAA;;;;AACA;;AAEA;;;;;;AAEA,sBAASA,aAAT,CAAuB,UAASC,IAAT,EAAeC,IAAf,EAAqB;AACxCA,SAAK,IAAL,EAAWD,KAAKE,EAAhB;AACH,CAFD;;AAIA,sBAASC,eAAT,CAAyB,UAASD,EAAT,EAAaD,IAAb,EAAmB;AACxC,mBAAUG,QAAV,CAAmBF,EAAnB,EAAuBG,IAAvB,CAA4B,UAASL,IAAT,EAAe;AACvC,YAAIA,IAAJ,EAAU;AACNC,iBAAK,IAAL,EAAWD,KAAKM,GAAL,EAAX;AACH,SAFD,MAEO;AACHL,iBAAKD,KAAKO,MAAV,EAAkB,IAAlB;AACH;AACJ,KAND;AAOH,CARD;;AAUA,sBAASC,GAAT,CAAa,4BAAa;AACtBC,mBAAe,UADO;AAEtBC,mBAAe,UAFO;AAGtBC,uBAAmB;AAHG,CAAb,EAIV,UAASC,GAAT,EAAcC,QAAd,EAAwBC,QAAxB,EAAkCb,IAAlC,EAAwC;AACvC,mBAAUc,OAAV,CAAkB;AACdC,oBAAY,CACR,IADQ,EACF,UADE,CADE;AAIdC,eAAO;AACHJ,sBAAUA;AADP;AAJO,KAAlB,EAOGR,IAPH,CAOQ,UAASL,IAAT,EAAe;AACnB,YAAI,CAACA,IAAL,EAAW;AACP,mBAAOC,KAAK,IAAL,EAAW,KAAX,EAAkB,EAACiB,SAAS,sBAAV,EAAlB,CAAP;AACH;AACD,eAAOjB,KAAK,IAAL,EAAWD,KAAKM,GAAL,EAAX,CAAP;AACH,KAZD,EAYGa,KAZH,CAYS,YAAW;AAChB,eAAOlB,KAAK,IAAL,EAAW,KAAX,CAAP;AACH,KAdD;AAeH,CApBY,CAAb","file":"LDPassport.js","sourcesContent":["import passport from 'koa-passport';\r\nimport {Strategy} from 'passport-local';\r\n\r\nimport UserModel from '../../models/user.model';\r\n\r\npassport.serializeUser(function(user, done) {\r\n    done(null, user.id);\r\n});\r\n\r\npassport.deserializeUser(function(id, done) {\r\n    UserModel.findById(id).then(function(user) {\r\n        if (user) {\r\n            done(null, user.get());\r\n        } else {\r\n            done(user.errors, null);\r\n        }\r\n    });\r\n});\r\n\r\npassport.use(new Strategy({\r\n    usernameField: 'username',\r\n    passwordField: 'password',\r\n    passReqToCallback: true\r\n}, function(req, username, password, done) {\r\n    UserModel.findOne({\r\n        attributes: [\r\n            'id', 'username'\r\n        ],\r\n        where: {\r\n            username: username\r\n        }\r\n    }).then(function(user) {\r\n        if (!user) {\r\n            return done(null, false, {message: 'Email does not exist'});\r\n        }\r\n        return done(null, user.get());\r\n    }).catch(function() {\r\n        return done(null, false);\r\n    });\r\n}));"]}