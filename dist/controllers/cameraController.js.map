{"version":3,"sources":["../../src/controllers/cameraController.js"],"names":["CameraController","ctx","data","request","body","info","error","msg","isExist","ip","add_camera","result","id","params","delete_camera","_id","edit_camera","query","sort","range","filter","sortObj","JSON","parse","rangeObj","filterObj","sortP","length","pageStart","pageEnd","getTotal","total","pagination","pageSize","find_camera","findAll","find_one"],"mappings":"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","file":"cameraController.js","sourcesContent":["/**\n * Created by chen on 17-8-23.\n */\nimport logger from '../logger';\n\nimport CameraService from '../services/cameraService';\n\nclass CameraController {\n    static async add_camera(ctx){\n        const data = ctx.request.body;\n        logger.info(data);\n\n        if(!data) return ctx.error={ msg: '发送数据失败!' };\n        const isExist = await CameraService.isExist({ip:data.ip})\n        //const isExist = await CameraModel.findOne({ip:data.ip});\n\n        if(isExist) return ctx.error={ msg: 'ip为[' + data.ip + ']的摄像头ip已存在!' };\n\n        const result = await CameraService.add_camera(data)\n\n        let msg = '';\n        if(result) {\n            msg = '添加摄像头'+ data.ip +'成功';\n            return ctx.body = {msg:msg,data:data};\n        }else{\n            msg = '添加失败';\n            return ctx.error={msg: msg};\n        }\n\n    }\n\n    static async delete_camera(ctx) {\n        const { id } = ctx.params;\n        const result = await CameraService.delete_camera({id:id})\n        let msg = '';\n        if(result) {\n            msg = '删除摄像头成功';\n            return ctx.body = {msg:msg,data:result};\n        }else{\n            msg = '删除摄像头失败';\n            return ctx.error={msg: msg};\n        }\n\n    }\n\n    static async edit_camera(ctx){\n        const data = ctx.request.body;\n        logger.info(data);\n        let _id = data._id;\n        delete data._id;\n        const result = await CameraService.edit_camera({_id:_id},data);\n        if(result) return ctx.body = {msg:'修改摄像头成功',data:result};\n        return ctx.error={msg: '修改摄像头失败!'};\n    }\n\n    static async find_camera(ctx){\n        const { sort,range,filter } = ctx.query;\n        let sortObj = JSON.parse(sort);\n        let rangeObj = JSON.parse(range);\n        let filterObj = JSON.parse(filter);\n        let sortP = {};\n        if(sortObj && sortObj.length >=2){\n            if('ASC' ===sortObj[1]){\n                sortP[sortObj[0]] = 1\n            }else{\n                sortP[sortObj[0]] = -1\n            }\n        }\n\n        let pageStart = 0,pageEnd = 0\n        if(rangeObj && rangeObj.length >=2){\n            pageStart = rangeObj[0];\n            pageEnd = rangeObj[1];\n        }\n\n        const total = await CameraService.getTotal();\n\n        const pagination = {};\n        pagination.pageStart = pageStart;\n        pagination.pageSize = pageEnd-pageStart+1;\n\n        let result = await CameraService.find_camera(filterObj,sortP,pagination);\n        if(result) return ctx.body = {msg:'查询摄像头',data:result,total:total};\n        return ctx.error={msg: '没有找到摄像头!'};\n    }\n\n    static async find_camera_noPage(ctx){\n        const { sort} = ctx.query;\n        let sortObj = JSON.parse(sort);\n        let sortP = {};\n        if(sortObj && sortObj.length >=2){\n            if('ASC' ===sortObj[1]){\n                sortP[sortObj[0]] = 1\n            }else{\n                sortP[sortObj[0]] = -1\n            }\n        }\n        let result = await CameraService.findAll(sortP);\n        if(result) return ctx.body = {msg:'查询摄像头',data:result};\n        return ctx.error={msg: '没有找到摄像头!'};\n    }\n\n    static async find_one(ctx){\n        const { id } = ctx.params;\n        const result = await CameraService.find_one(id);\n        if(result) ctx.body = {msg:'查询摄像头',data:result};\n        return ctx.error = {msg: '没有找到摄像头!'};\n    }\n\n}\n\nexport default CameraController;"]}